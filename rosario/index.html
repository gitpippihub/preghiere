<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santo Rosario</title>
    <link rel="stylesheet" href="../style/style.css">

    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">

    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        .rosario-container {
            text-align: center;
            padding: 20px 20px 60px 20px;
            cursor: pointer;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-focus-ring-color: transparent;
            outline: none;
            box-sizing: border-box;
        }
        
        .rosario-header {
            margin-bottom: 20px;
            flex-shrink: 0;
        }
        
        .misteri-title {
            color: #830f24;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .mistero-corrente {
            font-style: italic;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        
        .preghiera-corrente {
            font-size: 1.1em;
            line-height: 1.8;
            margin: 30px 0;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #830f24;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .controls {
            margin-top: 20px;
            flex-shrink: 0;
        }
        
        .back-btn {
            background-color: #f8f8f8;
            color: #830f24;
            border: 1px solid #ddd;
            padding: 6px 12px;
            font-size: 1.1em;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            font-family: Arial, sans-serif;
        }
        
        .back-btn:hover {
            background-color: #830f24;
            color: white;
            border-color: #830f24;
        }
        
        .progress-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }
        
        #titolo-rosario {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .ave-counter {
            display: inline-block;
            margin: 10px 5px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #ddd;
            line-height: 35px;
            font-size: 0.9em;
        }
        
        .ave-counter.completed {
            background-color: #830f24;
            color: white;
        }
        
        .ave-counter.current {
            background-color: #ffd700;
            color: black;
        }
        
        @media (prefers-color-scheme: dark) {
            .progress-bar {
                background-color: #444;
            }
            
            .ave-counter {
                background-color: #555;
                color: #ccc;
            }
            
            .progress-text {
                color: #aaa;
            }
        }
    </style>
</head>
<body>
    <div class="rosario-container" id="rosarioContainer">
        <div class="rosario-header">
            <div class="misteri-title" id="misteriTitle"></div>
            <div class="mistero-corrente" id="misteroCorrente"></div>
        </div>
        
        <div class="preghiera-corrente" id="preghieraCorrente">
            Clicca per iniziare il Santo Rosario
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="progress-text" id="progressText">
            Preparati per iniziare
        </div>
        
        <div id="aveCounter" style="margin: 20px 0; flex-shrink: 0;"></div>
        
        <div class="controls">
            <button class="back-btn" onclick="indietro()" id="backBtn" style="display: none;">‹</button>
            <span style="font-size: 0.9em; color: #666;">Clicca ovunque per continuare</span>
        </div>
    </div>

    <script>
        // Definizione dei misteri base
        const misteriBase = {
            gaudiosi: {
                nome: "Misteri Gaudiosi",
                lista: [
                    {
                        titolo: "L'Annunciazione dell'Angelo a Maria",
                        descrizione: "[Descrizione del primo mistero gaudioso - da compilare]"
                    },
                    {
                        titolo: "La visita di Maria SS. a S. Elisabetta",
                        descrizione: "[Descrizione del secondo mistero gaudioso - da compilare]"
                    },
                    {
                        titolo: "La nascita di Gesù",
                        descrizione: "[Descrizione del terzo mistero gaudioso - da compilare]"
                    },
                    {
                        titolo: "La presentazione di Gesù al Tempio",
                        descrizione: "[Descrizione del quarto mistero gaudioso - da compilare]"
                    },
                    {
                        titolo: "Il ritrovamento di Gesù nel Tempio",
                        descrizione: "[Descrizione del quinto mistero gaudioso - da compilare]"
                    }
                ]
            },
            dolorosi: {
                nome: "Misteri Dolorosi",
                lista: [
                    {
                        titolo: "L'Agonia di Gesù nel Getsemani",
                        descrizione: "[Descrizione del primo mistero doloroso - da compilare]"
                    },
                    {
                        titolo: "La flagellazione di Gesù",
                        descrizione: "[Descrizione del secondo mistero doloroso - da compilare]"
                    },
                    {
                        titolo: "L'incoronazione di Spine",
                        descrizione: "[Descrizione del terzo mistero doloroso - da compilare]"
                    },
                    {
                        titolo: "Il viaggio di Gesù al Calvario",
                        descrizione: "[Descrizione del quarto mistero doloroso - da compilare]"
                    },
                    {
                        titolo: "La morte di Gesù in croce",
                        descrizione: "[Descrizione del quinto mistero doloroso - da compilare]"
                    }
                ]
            },
            gloriosi: {
                nome: "Misteri Gloriosi",
                lista: [
                    {
                        titolo: "La Resurrezione di Gesù",
                        descrizione: "[Descrizione del primo mistero glorioso - da compilare]"
                    },
                    {
                        titolo: "L'Ascensione di Gesù al Cielo",
                        descrizione: "[Descrizione del secondo mistero glorioso - da compilare]"
                    },
                    {
                        titolo: "La discesa dello Spirito Santo",
                        descrizione: "[Descrizione del terzo mistero glorioso - da compilare]"
                    },
                    {
                        titolo: "L'Assunzione di Maria in Cielo",
                        descrizione: "[Descrizione del quarto mistero glorioso - da compilare]"
                    },
                    {
                        titolo: "L'incoronazione di Maria",
                        descrizione: "[Descrizione del quinto mistero glorioso - da compilare]"
                    }
                ]
            },
            luminosi: {
                nome: "Misteri Luminosi",
                lista: [
                    {
                        titolo: "Il Battesimo di Gesù nel Giordano",
                        descrizione: "[Descrizione del primo mistero luminoso - da compilare]"
                    },
                    {
                        titolo: "Il miracolo di Gesù alle nozze di Cana",
                        descrizione: "[Descrizione del secondo mistero luminoso - da compilare]"
                    },
                    {
                        titolo: "L'annuncio del Regno di Dio",
                        descrizione: "[Descrizione del terzo mistero luminoso - da compilare]"
                    },
                    {
                        titolo: "La Trasfigurazione di Gesù",
                        descrizione: "[Descrizione del quarto mistero luminoso - da compilare]"
                    },
                    {
                        titolo: "L'istituzione dell'Eucaristia",
                        descrizione: "[Descrizione del quinto mistero luminoso - da compilare]"
                    }
                ]
            }
        };

        // Mappatura dei giorni della settimana ai misteri
        const misteriPerGiorno = {
            1: misteriBase.gaudiosi,  // Lunedì - Misteri Gaudiosi
            2: misteriBase.dolorosi,  // Martedì - Misteri Dolorosi
            3: misteriBase.gloriosi,  // Mercoledì - Misteri Gloriosi
            4: misteriBase.luminosi,  // Giovedì - Misteri Luminosi
            5: misteriBase.dolorosi,  // Venerdì - Misteri Dolorosi
            6: misteriBase.gaudiosi,  // Sabato - Misteri Gaudiosi
            0: misteriBase.gloriosi   // Domenica - Misteri Gloriosi
        };

        // Preghiere del Rosario
        const preghiere = {
            segnoDelCroce: "Nel nome del Padre, del Figlio e dello Spirito Santo. Amen.",
            credoApostolico: "Io credo in Dio, Padre onnipotente, Creatore del cielo e della terra. E in Gesù Cristo, Suo unico Figlio, nostro Signore, il quale fu concepito di Spirito Santo, nacque da Maria Vergine, patì sotto Ponzio Pilato, fu crocifisso, morì e fu sepolto; discese agli inferi; il terzo giorno risuscitò da morte; salì al cielo, siede alla destra di Dio Padre onnipotente: di là verrà a giudicare i vivi e i morti. Credo nello Spirito Santo, la santa Chiesa cattolica, la comunione dei santi, la remissione dei peccati, la risurrezione della carne, la vita eterna. Amen.",
            padreNostro: "Padre nostro che sei nei cieli, sia santificato il tuo nome, venga il tuo regno, sia fatta la tua volontà come in cielo così in terra. Dacci oggi il nostro pane quotidiano, e rimetti a noi i nostri debiti come noi li rimettiamo ai nostri debitori, e non ci indurre in tentazione, ma liberaci dal male. Amen.",
            aveMaria: "Ave, o Maria, piena di grazia, il Signore è con te. Tu sei benedetta fra le donne e benedetto è il frutto del tuo seno, Gesù. Santa Maria, Madre di Dio, prega per noi peccatori, adesso e nell'ora della nostra morte. Amen.",
            gloria: "Gloria al Padre e al Figlio e allo Spirito Santo. Come era nel principio, e ora e sempre nei secoli dei secoli. Amen.",
            preghieraFatima: "Gesù mio, perdona le nostre colpe, preservaci dal fuoco dell'inferno, porta in cielo tutte le anime, specialmente le più bisognose della tua misericordia.",
            salveRegina: "Salve, Regina, Madre di misericordia, vita, dolcezza e speranza nostra, salve. A te ricorriamo, esuli figli di Eva; a te sospiriamo, gementi e piangenti in questa valle di lacrime. Orsù dunque, avvocata nostra, rivolgi a noi gli occhi tuoi misericordiosi. E mostraci, dopo questo esilio, Gesù, il frutto benedetto del tuo seno. O clemente, o pia, o dolce Vergine Maria."
        };

        // Stato del rosario
        let rosarioStato = {
            iniziato: false,
            step: 0,
            decina: 0,
            aveMariaCount: 0,
            misteriDelGiorno: null,
            misteroCorrente: 0
        };

        // Sequenza completa del rosario
        let sequenzaRosario = [];

        // Elementi DOM
        const misteriTitle = document.getElementById('misteriTitle');
        const misteroCorrente = document.getElementById('misteroCorrente');
        const preghieraCorrente = document.getElementById('preghieraCorrente');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const backBtn = document.getElementById('backBtn');
        const aveCounter = document.getElementById('aveCounter');
        const rosarioContainer = document.getElementById('rosarioContainer');

        function inizializzaRosario() {
            // Ottieni il giorno della settimana (0 = domenica, 1 = lunedì, ecc.)
            const oggi = new Date().getDay();
            rosarioStato.misteriDelGiorno = misteriPerGiorno[oggi];
            
            // Imposta il titolo dei misteri
            misteriTitle.textContent = rosarioStato.misteriDelGiorno.nome;
            
            // Crea la sequenza del rosario
            creaSequenzaRosario();
            
            // Inizialmente non mostrare alcun mistero corrente
            misteroCorrente.textContent = '';
        }

        function creaSequenzaRosario() {
            sequenzaRosario = [
                { tipo: 'segnoDelCroce', testo: preghiere.segnoDelCroce },
                { tipo: 'credo', testo: preghiere.credoApostolico },
                { tipo: 'padreNostro', testo: preghiere.padreNostro },
                { tipo: 'aveMaria', testo: preghiere.aveMaria, descrizione: '1ª Ave Maria', aveIniziale: 1 },
                { tipo: 'aveMaria', testo: preghiere.aveMaria, descrizione: '2ª Ave Maria', aveIniziale: 2 },
                { tipo: 'aveMaria', testo: preghiere.aveMaria, descrizione: '3ª Ave Maria', aveIniziale: 3 },
                { tipo: 'gloria', testo: preghiere.gloria }
            ];

            // Aggiungi le 5 decine
            for (let decina = 0; decina < 5; decina++) {
                // Annuncio del mistero
                sequenzaRosario.push({
                    tipo: 'mistero',
                    testo: `${decina + 1}° Mistero: ${rosarioStato.misteriDelGiorno.lista[decina].titolo}`,
                    misteroIndex: decina
                });
                
                // Descrizione del mistero
                sequenzaRosario.push({
                    tipo: 'descrizione',
                    testo: rosarioStato.misteriDelGiorno.lista[decina].descrizione,
                    misteroIndex: decina
                });
                
                // Padre Nostro
                sequenzaRosario.push({ tipo: 'padreNostro', testo: preghiere.padreNostro });
                
                // 10 Ave Maria
                for (let ave = 0; ave < 10; ave++) {
                    sequenzaRosario.push({
                        tipo: 'aveMaria',
                        testo: preghiere.aveMaria,
                        decina: decina,
                        aveNumber: ave + 1
                    });
                }
                
                // Gloria
                sequenzaRosario.push({ tipo: 'gloria', testo: preghiere.gloria });
                
                // Preghiera di Fatima
                sequenzaRosario.push({ tipo: 'fatima', testo: preghiere.preghieraFatima });
            }

            // Preghiera finale
            sequenzaRosario.push({ tipo: 'salveRegina', testo: preghiere.salveRegina });
        }

        function aggiornaMistero() {
            if (rosarioStato.misteroCorrente < 5) {
                misteroCorrente.textContent = `${rosarioStato.misteroCorrente + 1}° Mistero: ${rosarioStato.misteriDelGiorno.lista[rosarioStato.misteroCorrente].titolo}`;
            } else {
                misteroCorrente.textContent = "Preghiere finali";
            }
        }

        function aggiornaContatoreMaria(decina, aveNumber, isIniziali = false) {
            if (decina === undefined && !isIniziali) {
                aveCounter.innerHTML = '';
                return;
            }

            let html = '';
            
            if (isIniziali) {
                for (let i = 1; i <= 3; i++) {
                    let classe = '';
                    if (i < aveNumber) {
                        classe = 'completed';
                    } else if (i === aveNumber) {
                        classe = 'current';
                    }
                    html += `<span class="ave-counter ${classe}">${i}</span>`;
                }
            } else {
                for (let i = 1; i <= 10; i++) {
                    let classe = '';
                    if (i < aveNumber) {
                        classe = 'completed';
                    } else if (i === aveNumber) {
                        classe = 'current';
                    }
                    html += `<span class="ave-counter ${classe}">${i}</span>`;
                }
            }
            
            aveCounter.innerHTML = html;
        }

        function avanza() {
            if (!rosarioStato.iniziato) {
                rosarioStato.iniziato = true;
                backBtn.style.display = 'inline-block';
            }

            if (rosarioStato.step < sequenzaRosario.length) {
                const stepCorrente = sequenzaRosario[rosarioStato.step];
                
                // Aggiorna il contenuto
                preghieraCorrente.textContent = stepCorrente.testo;
                
                // Aggiorna il mistero corrente se necessario (solo dopo aver mostrato il titolo)
                if (stepCorrente.tipo === 'descrizione') {
                    rosarioStato.misteroCorrente = stepCorrente.misteroIndex;
                    aggiornaMistero();
                } else if (stepCorrente.tipo === 'mistero') {
                    // Quando mostriamo il titolo del mistero, nascondiamo il mistero corrente
                    misteroCorrente.textContent = '';
                }
                
                // Aggiorna il contatore delle Ave Maria
                if (stepCorrente.tipo === 'aveMaria' && stepCorrente.decina !== undefined) {
                    aggiornaContatoreMaria(stepCorrente.decina, stepCorrente.aveNumber);
                } else if (stepCorrente.tipo === 'aveMaria' && stepCorrente.aveIniziale !== undefined) {
                    aggiornaContatoreMaria(undefined, stepCorrente.aveIniziale, true);
                } else if (stepCorrente.tipo !== 'aveMaria') {
                    aggiornaContatoreMaria();
                }
                
                // Aggiorna la barra di progresso
                const progresso = ((rosarioStato.step + 1) / sequenzaRosario.length) * 100;
                progressFill.style.width = progresso + '%';
                progressText.textContent = `${rosarioStato.step + 1} / ${sequenzaRosario.length}`;
                
                rosarioStato.step++;
            } else {
                // Rosario completato
                preghieraCorrente.innerHTML = '<strong>Rosario completato!</strong><br>Che la Madonna ti benedica.';
                progressText.textContent = 'Rosario completato';
                aggiornaContatoreMaria();
            }
        }

        function indietro() {
            if (rosarioStato.step > 0) {
                rosarioStato.step--;
                
                if (rosarioStato.step === 0) {
                    rosarioStato.iniziato = false;
                    backBtn.style.display = 'none';
                    preghieraCorrente.textContent = 'Clicca per iniziare il Santo Rosario';
                    progressFill.style.width = '0%';
                    progressText.textContent = 'Preparati per iniziare';
                    aggiornaContatoreMaria();
                    return;
                }
                
                const stepCorrente = sequenzaRosario[rosarioStato.step - 1];
                
                // Aggiorna il contenuto
                preghieraCorrente.textContent = stepCorrente.testo;
                
                // Aggiorna il mistero corrente se necessario
                if (stepCorrente.tipo === 'descrizione') {
                    rosarioStato.misteroCorrente = stepCorrente.misteroIndex;
                    aggiornaMistero();
                } else if (stepCorrente.tipo === 'mistero') {
                    // Quando torniamo al titolo del mistero, nascondiamo il mistero corrente
                    misteroCorrente.textContent = '';
                } else {
                    // Per altri tipi, trova il mistero precedente più vicino
                    let misteroTrovato = false;
                    for (let i = rosarioStato.step - 1; i >= 0; i--) {
                        if (sequenzaRosario[i].tipo === 'descrizione') {
                            rosarioStato.misteroCorrente = sequenzaRosario[i].misteroIndex;
                            aggiornaMistero();
                            misteroTrovato = true;
                            break;
                        }
                    }
                    if (!misteroTrovato) {
                        misteroCorrente.textContent = '';
                    }
                }
                
                // Aggiorna il contatore delle Ave Maria
                if (stepCorrente.tipo === 'aveMaria' && stepCorrente.decina !== undefined) {
                    aggiornaContatoreMaria(stepCorrente.decina, stepCorrente.aveNumber);
                } else if (stepCorrente.tipo === 'aveMaria' && stepCorrente.aveIniziale !== undefined) {
                    aggiornaContatoreMaria(undefined, stepCorrente.aveIniziale, true);
                } else if (stepCorrente.tipo !== 'aveMaria') {
                    aggiornaContatoreMaria();
                }
                
                // Aggiorna la barra di progresso
                const progresso = (rosarioStato.step / sequenzaRosario.length) * 100;
                progressFill.style.width = progresso + '%';
                progressText.textContent = `${rosarioStato.step} / ${sequenzaRosario.length}`;
            }
        }

        // Event listeners
        document.addEventListener('click', function(e) {
            // Non avanzare se si clicca sul pulsante indietro
            if (e.target.id === 'backBtn' || e.target.closest('#backBtn')) {
                return;
            }
            avanza();
        });

        // Previeni il click del pulsante indietro dal propagarsi
        backBtn.addEventListener('click', function(e) {
            e.stopPropagation();
        });

        // Inizializza il rosario al caricamento della pagina
        window.onload = function() {
            inizializzaRosario();
        };
    </script>
</body>
</html>
